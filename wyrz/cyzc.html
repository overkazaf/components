<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>创业导航-创业政策</title>
    <link rel="stylesheet" type="text/css" href="/cynt/index/css/base.css" />
    <link rel="stylesheet" type="text/css" href="/cynt/index/css/index.css" />
    <link rel="stylesheet" href="/cynt/newindex/css/cyzc.css">
    <style type="text/css">
.cyzc-container {margin: 100px auto 30px;}  
.cyzc-container .news-list .title {font-size:16px;}
.cyzc-container .news-list .item {width:1138px;padding:10px 0px;}
#wizard {margin:20px auto;overflow:hidden;position:relative;height:500px;}
#wizard .items{width:20000px; height:400px;overflow:hidden; position:relative;}
#wizard .items .item-list{
    position:absolute;
    left:0;top:0;width:100%;height:auto;
}

.clearfix:after{
    content:"";
    width:0;height:0;display:block;clear:both;
}
#wizard .items .item-list .page-item{
    width : 100%;height:600px;
}
.page{width:1158px;float:left;background:#FFF;border:#cadbf7 1px solid;overflow:hidden;padding:0px 20px;}
.page h3{height:42px; font-size:16px; border-bottom:1px dotted #ccc; margin-bottom:20px; padding-bottom:5px;}
.page h3 em{font-size:12px; font-weight:500; font-style:normal;}
.page p{line-height:24px;}
.page p label{font-size:14px; display:block;}
.btn_nav{height:36px; line-height:36px; margin:20px auto;}
.nextBox {text-align:center;margin:20px 0px 0px;}
.prevBox {text-align:center;margin:0px 0px 20px;}
.title {height:60px;line-height:40px;padding-top:20px;color:#92abed;font-size:20px;padding-left:60px;}
.title1 {background:url(/cynt/newindex/images/one.jpg) left center no-repeat;}
.title2 {background:url(/cynt/newindex/images/two.jpg) left center no-repeat;}
.title3 {background:url(/cynt/newindex/images/three.jpg) left center no-repeat;}
.cyzc-container .news-list .item .title {padding-left:0px;line-height:30px;padding-top:0px;}
.cyzc-container .news-list .item {margin:10px 0px;}
.msg-type{
    color:#4f9f1e !important;
}

.detail{
    color:#0d67e0 !important;
}
</style>
    <script src='/cynt/static/js/jquery.min.js'></script>
</head>

<body>
    <div class="cyzc-container">
        <div class="main_nav">
            <span class="nav_prev"></span>
            <span class="nav_font">创业导航-创业政策</span>
        </div>
        <div id="wizard">
            <div class="items clearfix">
                <ul class="item-list">
                    <li class="page-item">
                        <div class="page">
                            <div class="title title1" style="padding-left:60px;">请选择团队、企业类型</div>
                            <ul class="attr-list attr-list1">
                                <li class="item item1" data-value="创客、创业团队">
                                    <a href="javascript:;"> <i class="icon"></i>
                                        <br />
                                        <span>创客、创业团队</span>
                                    </a>
                                </li>
                                <li class="item item2" data-value="创业企业">
                                    <a href="javascript:;"> <i class="icon"></i>
                                        <br />
                                        <span>创业企业</span>
                                    </a>
                                </li>
                                <li class="item item3" data-value="科技型中小企业">
                                    <a href="javascript:;">
                                        <i class="icon"></i>
                                        <br />
                                        <span>科技型中小企业</span>
                                    </a>
                                </li>
                                <li class="item item4" data-value="高新技术企业">
                                    <a href="javascript:;">
                                        <i class="icon"></i>
                                        <br />
                                        <span>高新技术企业</span>
                                    </a>
                                </li>
                                <li class="item item5" data-value="其他">
                                    <a href="javascript:;">
                                        <i class="icon"></i>
                                        <br />
                                        <span>其他</span>
                                    </a>
                                </li>
                            </ul>
                            <div class="nextBox">
                                <a href="javascript:;" class="next">
                                    <img src="/cynt/newindex/images/next.jpg" />
                                </a>
                            </div>
                        </div>
                    </li>
                    <li  class="page-item">
                        <div class="page">
                            <div class="prevBox">
                                <a href="javascript:;" class="prev">
                                    <img src="/cynt/newindex/images/pre.jpg" />
                                </a>
                            </div>
                            <div class="title title2" style="padding-left:60px;">请选择政策类型</div>

                            <ul class="attr-list attr-list2">
                                <li class="item" data-value="科技政策">
                                    <a href="javascript:;">科技政策</a>
                                </li>
                                <li class="item" data-value="人才政策">
                                    <a href="javascript:;">人才政策</a>
                                </li>
                                <li class="item" data-value="财税政策">
                                    <a href="javascript:;">财税政策</a>
                                </li>
                                <li class="item" data-value="金融政策">
                                    <a href="javascript:;">金融政策</a>
                                </li>
                                <li class="item" data-value="其他政策">
                                    <a href="javascript:;">其他政策</a>
                                </li>
                            </ul>
                            <div class="nextBox">
                                <a href="javascript:;" class="next">
                                    <img src="/cynt/newindex/images/next.jpg" />
                                </a>
                            </div>
                        </div>
                    </li>
                    <li  class="page-item">
                        <div class="page">
                            <div class="prevBox">
                                <a href="javascript:;" class="prev">
                                    <img src="/cynt/newindex/images/pre.jpg" />
                                </a>
                            </div>
                            <div class="title title3" style="padding-left:60px;">请查看政策</div>
                            <div class="listDiv">
                                <div class="news-list">
                                </div>
                                <div class="cb"></div>
                                <div class="PageBox"></div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="cb"></div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            var currentIndex = 0,
                totLength = $('.item-list').find('li').length;

            $('.next').click(function (){
                if(currentIndex == totLength - 2){
                     getData($('.listDiv'), 'cynt,cyzc', 1, 2);
                }
                if (currentIndex < totLength - 1) {
                    $('.item-list').animate({
                        top : -(++currentIndex) * 600
                    }, 500, 'swing')
                }
            });

            $('.prev').click(function (){
                if (currentIndex > 0) {
                    $('.item-list').animate({
                        top : -(--currentIndex) * 600
                    }, 500, 'swing')
                }
            });


            $('.PageBox').on('click', function (ev){
                var target = ev.target;
                var tagName = target.tagName.toLowerCase();
                if (tagName == 'a') {
                    var $ctx   = $(target).closest('.listDiv'),
                        page   = $(target).html(),
                        eqName = gEqName;
                    
                    if (!isNaN(page)) {
                        if (+page <= +$(target).closest('.PageBox').attr('totalPage')) {
                            getData($ctx, "cynt,cyzc", page, gDefaultPageSize);
                        }
                    }
                } else if (tagName == 'span') {
                    var $pb = $(target).closest('.PageBox'),
                        totalPage = $pb.attr('totalPage'),
                        eqName    = gEqName,
                        currentPage = +$('.current', $pb).html(),
                        $ctx   = $(target).closest('.listDiv');
                    var classFlag = ''
                    if ($(target).hasClass('current')) {
                        classFlag = 'current';
                    } else if ($(target).hasClass('pre')) {
                        classFlag = 'pre';
                    } else if ($(target).hasClass('next')) {
                        classFlag = 'next';
                    }

                    switch(classFlag) {
                        case 'current' :
                            // do nothing
                            break;
                        case 'pre' :
                            if (currentPage == 1) {
                                // do nothing
                            } else {
                                getData($ctx, "cynt,cyzc", currentPage - 1, gDefaultPageSize);
                            }
                            break;
                        case 'next' :
                            if (currentPage >= totalPage) {
                                // do nothing
                            } else {
                                getData($ctx, "cynt,cyzc", currentPage + 1, gDefaultPageSize);
                            }
                            break;
                        default : 
                            break;
                    }
                }
            });
        })
    </script>
    <script type="text/javascript" language="javascript">
    var list=$('.news-list');
    var pagesize=2;
    var nNow=1;
    var shtd = "创客、创业团队";
    var zclx = "";
    var gDefaultImg = '/cynt/images/default/225-160.png';
    var gDefaultPageSize = 2;
    function gonext() {
        //loadData();

        getData($('.listDiv'), 'cynt,cyzc', 1, pagesize);

        $('html, body').animate({scrollTop: $(document).height()}, 'slow');
    }

function getData($ctx, lmxx, pagenum, pagesize){

    $.ajax({ 
        type: 'POST', 
        url: '/TrueCMS/messageController/getMessageByCondition.do?', 
        data: "lmxx=" + lmxx + "&pagenum=" + pagenum + "&pagesize=" + pagesize+ "&cms_like_shtd="+ shtd + "&cms_like_zclx=" +zclx,
        cache : false,
        dataType: "json",
        success:function(data){ 
            if (data['success'] == true) {
                $ctx.find('.loading').remove();

                renderContents($ctx, data, function (){
                    renderPageBar($ctx, data); 
                });
            }
        }, 
        error:function(){ 
            alert("数据加载失败"); 
        } 
    }); 
}

/**
 * [renderPageBar 渲染分页栏]
 * @param  {[type]} $ctx [description]
 * @param  {[type]} json [description]
 * @return {[type]}      [description]
 */
function renderPageBar($ctx, json) {
    //<div id="PageBox" class="PageBox">
    
    var 
        totalCount  = json['totalCount'],
        pageNum     = json['pageNum'],
        pageSize    = json['pageSize'],
        totalPage   = $('.PageBox', $ctx) || 0;

    if (totalCount == 0) {
        totalPage = 0;
    } else {
        if (totalCount % pageSize == 0) {
            totalPage = Math.floor(totalCount / pageSize);
        } else {
            totalPage = Math.floor(totalCount / pageSize) + 1;
        }
    }

    //console.log('totalPage:' + totalPage);
    // 在这里要修正参数
    if (totalPage < pageNum - 1) {
        pageNum = totalPage;
    }
    
    var pagination = '';
    var extraPrevCls = ' btn-enabled',
        extraNextCls = ' btn-enabled';

        var pagebtn = '';

        if (totalCount == 0) {
            extraPrevCls = ' btn-disabled';
            extraNextCls = ' btn-disabled';
        } else {
            if (pageNum == totalPage) {
                extraNextCls = ' btn-disabled';
            } 

            if (pageNum == 1 || pageNum == 0) {
                extraPrevCls = ' btn-disabled';
            }
        }
        


        pagination += '<span class="pre'+ extraPrevCls +'">上一页</span>';


        if (totalPage > 10) {
            if (pageNum < 6) {
                for (var page = 1; page <= 5; page++) {
                    if (pageNum != page) {
                        pagination += '<a href="javascript:void(0);">' + page + '</a>';
                    } else {
                        pagination += '<span class="current">'+ page +'</span>';
                    }
                }

                pagination += '<a href="javascript:void(0);">6</a>';
                pagination += '<a href="javascript:void(0);">7</a>';
                pagination += '<a href="javascript:void(0);">8</a>';
                pagination += '<span class="shenglue">...</span>';
                pagination += '<a href="javascript:void(0);">19</a>';
                pagination += '<a href="javascript:void(0);">20</a>';
            } else {
                for (var page = pageNum - 4; page <= pageNum + 3; page++) {
                    if (pageNum != page) {
                        pagination += '<a href="#">' + page + '</a>';
                    } else {
                        pagination += '<span class="current">'+ page +'</span>';
                    }
                }
                pagination += '<span class="shenglue">...</span>';
                
                pagination += '<a href="javascript:void(0);">' + (page+ 13)  +'</a>';
                pagination += '<a href="javascript:void(0);">' + (page+ 14) + '</a>';
            }
        } else {
            for (var page = 1; page <= totalPage; page++) {
                if (pageNum != page) {
                    pagination += '<a href="javascript:void(0);">' + page + '</a>';
                } else {
                    pagination += '<span class="current">'+ page +'</span>';
                }
            }
        }

        pagination += '<span class="next'+ extraNextCls +'">下一页</span>';

    $('.PageBox', $ctx).empty().html(pagination);

    $('.PageBox', $ctx).attr('totalPage', totalPage);
    //</div>
}

/**
 * [renderContents Update dom by given json data]
 * @param  {[type]} $dom [description]
 * @param  {[type]} json [description]
 * @return {[type]}      [description]
 */
function renderContents ($dom, json, callback) {
    var fragment    = '',
        msgList     = json['msgList'];
    if (msgList) {

        var subListFragment = renderSubListFragment(msgList);
        fragment += '<div class="news-list">' +
                        subListFragment +
                    '</div>';

        $('.news-list', $dom).replaceWith(fragment);

        callback && $.isFunction(callback) && callback();
    }
}

function renderSubListFragment (jsonList) {
    var fragment = '';
    if (jsonList.length) {

        $.each(jsonList, function (i, item){
            var 
                headImg     = item['headimg'],
                headImg     = headImg == null ? gDefaultImg : headImg,
                digest      = item['jj'],
                moreUrl     = item['htmlpath'],
                title       = item['msgtitle'],
                zclx        = item['zclx'];

            if (digest) {
                digest = digest.length > 100 ? digest.substring(0, 101)+'...' : digest;
            }

            fragment += '<div class="item">' +
                            '<h6 class="title" style="height:auto;">' +
                            '<a href="'+ moreUrl +'" target="_blank">'+ title +'</a>' +
                            '</h6>' +
                            '<p><span class="msg-type">【'+ zclx +'】</span></p>' +
                            '<p class="cnt">'+ digest +
                            '<a href="'+moreUrl+'" target="_blank" class="detail">[详细]</a>' +
                            '<p>'+
                        '</div>';
        });
    }

    return fragment;
}

function loadData(){
    var _url = '/TrueCMS/messageController/getMessageByCondition.do?lmxx=cynt,cyzc&pagenum='
        +nNow+'&pagesize='+pagesize+'&cms_like_shtd='+shtd+'&cms_like_zclx='+zclx;
    $.ajax({
        url:_url,
        async : false,
        success:function(data){ 
            var result = $.parseJSON(data);
            if(result.totalCount > 0){
                var resulthtml = '';
                list.empty();
                $.each(result.msgList, function(i, msg){
                    var title = msg.msgtitle;
                    title = title && title.length < 50 ? title : title.substring(0,50)+"...";
                    resulthtml +='<div class="item">'
                    +'<h6 class="title" style="height:auto;">'
                    +'<a href="'+msg.htmlpath+'" target="_blank">'+title+'</a>'
                    +'</h6>'
                    +'<p><span class="msg-type">【'+msg.zclx+'】</span></p>'
                    +'<p class="cnt">'+(!msg.jj ? '' : msg.jj.substring(0,120)+"...")
                    +'<a href="'+msg.htmlpath+'" target="_blank" class="detail">[详细]</a>'
                    +'</p>'
                    +'</div>';
                });
                list.append(resulthtml);
            }
            for(i=(nNow-1)*pagesize;i<nNow*pagesize;i++){
                list.find('li:eq('+i+')').slideDown('slow');
            }
            if (nNow*pagesize>=result.totalCount){
                $('.findmore').slideUp('slow');
            }else{
                $('.findmore').slideDown('slow');
            }
            nNow++;
        }    
    });
}

$(document).ready(function(){
    // loadData();
    $('.attr-list1 li').each(function(i){
        $(this).click(function(){
        $('.cyzcdiv2').css('display','block');
        zclx = $(this).attr("data-value");  
        $('.attr-list1 li').removeClass("active")
        $(this).addClass("active");     
        });
  });

    $('.attr-list2 li').each(function(i){
        $(this).click(function(){
        $('.cyzcdiv3').css('display','block');      
        zclx = $(this).attr("data-value");
        nNow=1;     
        list.empty();
        getData($('.listDiv'), 'cynt,cyzc', 1, 2);     
        $('.attr-list2 li').removeClass("active")
        $(this).addClass("active");     
        });
  });
});

</script>
</body>
</html>