<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>创业导航-我要融资</title>
    <link rel="stylesheet" type="text/css" href="/cynt/static/css/base.css" />
	<link href="/cynt/index/css/index.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="/cynt/newindex/css/cyzc.css">
    <style type="text/css">
.cyzc-container {margin: 50px auto 30px;}	
.cyzc-container .news-list .title {font-size:16px;}
.cyzc-container .news-list .item {width:556px;padding:10px 0px;}
#wizard {margin:20px auto;overflow:hidden;position:relative;height:500px;}
#wizard .items{height:500px;overflow:hidden; position:relative;}
#wizard .items .item-list{
    position:absolute;
    left:0;top:0;width:100%;height:auto;
}

.clearfix:after{
    content:"";
    width:0;height:0;display:block;clear:both;
}
#wizard .items .item-list .page-item{
    width : 100%;height:700px;
}
.page{width:1158px;float:left;background:#FFF;border:#cadbf7 1px solid;overflow:hidden;padding:0px 20px;}
.page h3{height:42px; font-size:16px; border-bottom:1px dotted #ccc; margin-bottom:20px; padding-bottom:5px;}
.page h3 em{font-size:12px; font-weight:500; font-style:normal;}
.page p{line-height:24px;}
.page p label{font-size:14px; display:block;}
.btn_nav{height:36px; line-height:36px; margin:20px auto;}
.nextBox {text-align:center;margin:20px 0px 0px;}
.prevBox {text-align:center;margin:0px 0px 20px;}
.title {height:60px;line-height:40px;padding-top:20px;color:#92abed;font-size:20px;padding-left:60px;}
.title1 {background:url(/cynt/newindex/images/one.jpg) left center no-repeat;}
.title2 {background:url(/cynt/newindex/images/two.jpg) left center no-repeat;}
.title3 {background:url(/cynt/newindex/images/three.jpg) left center no-repeat;}
.cyzc-container .news-list .item .title {padding-left:0px;line-height:30px;padding-top:0px;}
.cyzc-container .news-list .item {margin:10px 0px;}

</style>
<script src='/cynt/static/js/jquery.min.js'></script>
</head>

<body>
    <div class="cyzc-container">
        <div class="main_nav">
            <span class="nav_prev"></span>
            <span class="nav_font">创业导航-我要融资</span>
        </div>
        <div id="wizard">
            <div class="items clearfix">
                <ul class="item-list">
                    <li class="page-item">
                        <div class="page">
                            <div class="title title1" style="padding-left:60px;">请选择团队、企业类型</div>
                            <ul class="attr-list attr-list1">
					            <li class="item item1" data-value="创客、创业团队">
					                <a href="javascript:;">
					                    <i class="icon"></i><br />
					                    <span>创客、创业团队</span>
					                </a>
					            </li>
					            <li class="item item2" data-value="创业企业">
					                <a href="javascript:;">
					                    <i class="icon"></i><br />
					                    <span>创业企业</span>
					                </a>
					            </li>
					            <li class="item item3" data-value="科技型中小企业">
					                <a href="javascript:;">
					                    <i class="icon"></i><br />
					                    <span>科技型中小企业</span>
					                </a>
					            </li>
					            <li class="item item4" data-value="高新技术企业">
					                <a href="javascript:;">
					                    <i class="icon"></i><br />
					                    <span>高新技术企业</span>
					                </a>
					            </li>
					            <li class="item item5" data-value="其他">
					                <a href="javascript:;">
					                    <i class="icon"></i><br />
					                    <span>其他</span>
					                </a>
					            </li>
                            </ul>
                            <div class="nextBox">
                                <a href="javascript:;" class="next">
                                    <img src="/cynt/newindex/images/next.jpg" />
                                </a>
                            </div>
                        </div>
                    </li>
                    <li  class="page-item">
                        <div class="page">
                            <div class="prevBox">
                                <a href="javascript:;" class="prev">
                                    <img src="/cynt/newindex/images/pre.jpg" />
                                </a>
                            </div>
                            <div class="title title2" style="padding-left:60px;">请选融资方式</div>

                            <ul class="attr-list attr-list2">
                            	<li class="item" data-value="科技贷款"><a href="javascript:;">科技贷款</a></li>
                            	<li class="item" data-value="创业投资"><a href="javascript:;">创业投资</a></li>
                            	<li class="item" data-value="科技担保"><a href="javascript:;">科技担保</a></li>
                            	<li class="item" data-value="通创币,创新券,科技计划资助"><a href="javascript:;">科技计划资助</a></li>
					            <li class="item" data-value="人才资金"><a href="javascript:;">人才资金</a></li>
                            </ul>
                            <div class="nextBox">
                                <a href="javascript:;" class="next">
                                    <img src="/cynt/newindex/images/next.jpg" />
                                </a>
                            </div>
                        </div>
                    </li>
                    <li  class="page-item">
                        <div class="page">
                            <div class="prevBox">
                                <a href="javascript:;" class="prev">
                                    <img src="/cynt/newindex/images/pre.jpg" />
                                </a>
                            </div>
                            <div class="title title3" style="padding-left:60px;">查看相关信息</div>
                            <div class="listDiv">
							    <div class="news-list">
                                </div>
								<div class="cb"></div>
								<div class="PageBox"></div>
							</div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="cb"></div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            var currentIndex = 0,
                totLength = $('.item-list').find('li').length;				
            $('.next').click(function (){
			   var flag = false;		   
			   $('.page-item').eq(currentIndex).find('.attr-list li').each(function (){
			       if($(this).hasClass('active')){
				       flag = true;
				   }
			   });	
			   if (flag) {
				if(currentIndex < totLength - 1){
                    $('.item-list').animate({
                        top : -(++currentIndex) * 700
                    }, 500, 'swing')
				}
			   }else{
				    alert('当前选项未选，无法进入下一步！');
				}
            });

            $('.prev').click(function (){
                if (currentIndex > 0) {
                    $('.item-list').animate({
                        top : -(--currentIndex) * 700
                    }, 500, 'swing')
                }
            });
        })
    </script>
<script type="text/javascript" language="javascript">
var 
	gDefaultPageSize = 4,
	gDefaultImg = '/cynt/images/default/225-160.png';
var gEqName;	
var shtd="",
    zclx="";	 
$(function(){
    $('.attr-list1 li').each(function(i){
        $(this).click(function(){
		shtd = $(this).attr("data-value");	
		$('.attr-list1 li').removeClass("active")
        $(this).addClass("active");		
        });
    });  
  
    $('.attr-list2 li').each(function(i){
        $(this).click(function(){
        	$(this).toggleClass("active");

        	var arr = [];
        	$('.attr-list2 li').each(function (){
        		if ($(this).hasClass('active')) {
        			arr.push($(this).attr('data-value'));
        		}
        	});
			zclx = arr.join(',');
	        getData($('.listDiv'), 'cynt,wyrz', 1, gDefaultPageSize);	
	        
        });
    });

    $('.PageBox').on('click', function (ev){
    	var target = ev.target;
    	var tagName = target.tagName.toLowerCase();
    	if (tagName == 'a') {
    		var $ctx   = $(target).closest('.listDiv'),
	    		page   = $(target).html(),
				eqName = gEqName;
			
	    	if (!isNaN(page)) {
	    		if (+page <= +$(target).closest('.PageBox').attr('totalPage')) {
	    			getData($ctx, "cynt,wyrz", page, gDefaultPageSize);
	    		}
	    	}
    	} else if (tagName == 'span') {
    		var $pb = $(target).closest('.PageBox'),
	    		totalPage = $pb.attr('totalPage'),
	    		eqName    = gEqName,
	    		currentPage = +$('.current', $pb).html(),
	    		$ctx   = $(target).closest('.listDiv');
	    	var classFlag = ''
	    	if ($(target).hasClass('current')) {
	    		classFlag = 'current';
	    	} else if ($(target).hasClass('pre')) {
	    		classFlag = 'pre';
	    	} else if ($(target).hasClass('next')) {
	    		classFlag = 'next';
	    	}

	    	switch(classFlag) {
	    		case 'current' :
	    			// do nothing
	    			break;
	    		case 'pre' :
	    			if (currentPage == 1) {
	    				// do nothing
	    			} else {
	    				getData($ctx, "cynt,wyrz", currentPage - 1, gDefaultPageSize);
	    			}
	    			break;
	    		case 'next' :
	    			if (currentPage >= totalPage) {
	    				// do nothing
	    			} else {
	    				getData($ctx, "cynt,wyrz", currentPage + 1, gDefaultPageSize);
	    			}
	    			break;
	    		default : 
	    			break;
	    	}
    	}
    });
});


/**
 * [getData 分页接口, 获取当前数据信息]
 * @param  {[type]} lmlx     [description]
 * @param  {[type]} lmxx     [description]
 * @param  {[type]} pagenum  [description]
 * @param  {[type]} pagesize [description]
 * @return {[type]}          [description]
 */
function getData($ctx, lmxx, pagenum, pagesize){

    $.ajax({ 
        type: 'POST', 
        url: '/TrueCMS/messageController/getMessageByCondition.do?', 
        data: "lmxx=" + lmxx + "&pagenum=" + pagenum + "&pagesize=" + pagesize+ "&cms_like_shtd="+ shtd + "&cms_like_zclx=" +zclx ,
        cache : false,
        dataType: "json",
        success:function(data){ 
            if (data['success'] == true) {
            	$ctx.find('.loading').remove();

				renderContents($ctx, data, function (){
					renderPageBar($ctx, data); 
				});
            }
        }, 
        error:function(){ 
            alert("数据加载失败"); 
        } 
    }); 
}

/**
 * [renderContents Update dom by given json data]
 * @param  {[type]} $dom [description]
 * @param  {[type]} json [description]
 * @return {[type]}      [description]
 */
function renderContents ($dom, json, callback) {
	var fragment 	= '',
		msgList 	= json['msgList'];
	if (msgList) {

		var subListFragment = renderSubListFragment(msgList);
		fragment += '<div class="news-list">' +
					    subListFragment +
					'</div>';

		$('.news-list', $dom).replaceWith(fragment);

		callback && $.isFunction(callback) && callback();
	}
}

/**
 * [renderSubListFragment description]
 * @param  {[type]} jsonList [description]
 * @return {[type]}      [description]
 */
function renderSubListFragment (jsonList) {
	var fragment = '';
	if (jsonList.length) {

		fragment += '<ul class="qch_ul">';

		$.each(jsonList, function (i, item){
			var 
				headImg     = item['headimg'],
				headImg     = headImg == null ? gDefaultImg : headImg,
				digest 		= item['jj'],
				moreUrl     = item['htmlpath'],
				title       = item['msgtitle'];

			if (digest) {
				digest = digest.length > 100 ? digest.substring(0, 101)+'...' : digest;
			}
			fragment += '<li>' +
						    '<h3><a href="'+ moreUrl +'" target="_blank">'+ title +'</a></h3>' +
						    '<p>'+ digest +'<a href="'+ moreUrl +'" target="_blank">[详细]</a></p>' +
						'</li>';
		});
		fragment += '</ul>';
	}

	return fragment;
}


/**
 * [renderPageBar 渲染分页栏]
 * @param  {[type]} $ctx [description]
 * @param  {[type]} json [description]
 * @return {[type]}      [description]
 */
function renderPageBar($ctx, json) {
	//<div id="PageBox" class="PageBox">
	
	var 
		totalCount 	= json['totalCount'],
		pageNum 	= json['pageNum'],
		pageSize 	= json['pageSize'],
		totalPage   = $('.PageBox', $ctx) || 0;

	if (totalCount == 0) {
		totalPage = 0;
	} else {
		if (totalCount % pageSize == 0) {
			totalPage = Math.floor(totalCount / pageSize);
		} else {
			totalPage = Math.floor(totalCount / pageSize) + 1;
		}
	}

	//console.log('totalPage:' + totalPage);
	// 在这里要修正参数
	if (totalPage < pageNum - 1) {
		pageNum = totalPage;
	}
	
	var pagination = '';
	var extraPrevCls = ' btn-enabled',
		extraNextCls = ' btn-enabled';

		var pagebtn = '';

		if (totalCount == 0) {
			extraPrevCls = ' btn-disabled';
			extraNextCls = ' btn-disabled';
		} else {
			if (pageNum == totalPage) {
				extraNextCls = ' btn-disabled';
			} 

			if (pageNum == 1 || pageNum == 0) {
				extraPrevCls = ' btn-disabled';
			}
		}
		


		pagination += '<span class="pre'+ extraPrevCls +'">上一页</span>';


		if (totalPage > 10) {
			if (pageNum < 6) {
				for (var page = 1; page <= 5; page++) {
					if (pageNum != page) {
						pagination += '<a href="javascript:void(0);">' + page + '</a>';
					} else {
						pagination += '<span class="current">'+ page +'</span>';
					}
				}

				pagination += '<a href="javascript:void(0);">6</a>';
				pagination += '<a href="javascript:void(0);">7</a>';
				pagination += '<a href="javascript:void(0);">8</a>';
				pagination += '<span class="shenglue">...</span>';
				pagination += '<a href="javascript:void(0);">19</a>';
				pagination += '<a href="javascript:void(0);">20</a>';
			} else {
				for (var page = pageNum - 4; page <= pageNum + 3; page++) {
					if (pageNum != page) {
						pagination += '<a href="#">' + page + '</a>';
					} else {
						pagination += '<span class="current">'+ page +'</span>';
					}
				}
				pagination += '<span class="shenglue">...</span>';
				
				pagination += '<a href="javascript:void(0);">' + (page+ 13)  +'</a>';
				pagination += '<a href="javascript:void(0);">' + (page+ 14) + '</a>';
			}
		} else {
			for (var page = 1; page <= totalPage; page++) {
				if (pageNum != page) {
					pagination += '<a href="javascript:void(0);">' + page + '</a>';
				} else {
					pagination += '<span class="current">'+ page +'</span>';
				}
			}
		}

		pagination += '<span class="next'+ extraNextCls +'">下一页</span>';

	$('.PageBox', $ctx).empty().html(pagination);

	$('.PageBox', $ctx).attr('totalPage', totalPage);
	//</div>
}
</script>
</body>
</html>